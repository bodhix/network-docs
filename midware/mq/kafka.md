## Kafka

### 作用

官方的介绍是：A distributed streaming platform，总的来说，有以下三个作用：

- 消息系统：订阅 & 发布的消息队列，具体消息队列一般的作用：解耦、缓冲、削峰、异步等
- 流处理平台：能提供实时流处理数据来源，也提供了一个完整的流处理类库
- 存储系统：分布式、具有容错性的集群存储系统


### 基本概念
**Broker**：kafka实例

**Topic**：主题，对消息就是分类用的。生产者将消息发送到指定主题，消费者订阅对应主题，以消费信息

**Partiction**：分区，对主题进行逻辑分割，一个主题的某个消息，只会存在某个分区里。可以提高并发性（类似 redis 的集群）

**Replica**：副本，对分区进行复制备份，一个分区中的消息，有多份拷贝。可以提高可用性（类似 redis 的主从）。副本有 leader 和 follower，leader 负责读写，follower 只负责从 leader 同步数据

**Producer**：生产者

**Consumer**：消费者

**Consumer Group**：消费者组，用于实现多播。不同的消费者组，消费消息不会相互影响。在一个消费组内，一个分区只能给一个消费者消费。当组中的消费者个数大于分区个数的时候，就会有的消费者永远消费不到消息。当族中的消费者个数小于分区个数的时候，就会有一个消费者消费多个分区的情况。

### 其他概念

**AR**：分区所有副本集合

**ISR**：与 leader 保持一定程度同步的副本集合。一般情况下，leader 异常后选主，只在 ISR 中选择

**OSR**:与 leader 同步状态滞后的副本集合

**HW**：（high watermark）一个特殊的消息偏移量（offset），消费者只能获取到该值之前的消息

**LEO**：（Log End Offset）下一条消息写入的偏移量

后面两个概念需要理解一下：生产者往 leader 里面写数据，follower 从 leader 同步数据，由于 kafka 不是全同步，所以，follower 同步数据有一定的滞后性。HW 就是所有副本中同步的最小的下一条消息偏移量，而 LEO 就是 leader 下一条写入消息的偏移量。

**有序**：kafka 的有序性保证，是在分区级别的，而不是在主题级别。也就是说，如果真的希望保证有序，那么就使用一个分区，或者是自己保证将需要有序的信息写到同个分区。

### 生产者



### 消费者



### 主题和分区







